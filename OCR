using iText.Kernel.Pdf;
using iText.Kernel.Pdf.Canvas.Parser;
using iText.Kernel.Pdf.Canvas.Parser.Listener;
using iText.IO.Image;
using Tesseract;
using System;
using System.Drawing.Imaging;
using System.IO;
using System.Drawing;

class Program
{
    static void Main()
    {
        string pdfPath = @"C:\path\to\scanned.pdf";
        string tessDataPath = @"C:\Program Files\Tesseract-OCR\tessdata";

        using var pdfDoc = new PdfDocument(new PdfReader(pdfPath));
        var engine = new TesseractEngine(tessDataPath, "eng", EngineMode.Default);

        for (int i = 1; i <= pdfDoc.GetNumberOfPages(); i++)
        {
            var page = pdfDoc.GetPage(i);
            var strategy = new FilteredEventListener();
            var imageRenderListener = new ImageRenderListener(i);
            strategy.AttachEventListener(imageRenderListener);
            PdfCanvasProcessor parser = new PdfCanvasProcessor(strategy);
            parser.ProcessPageContent(page);

            foreach (var imagePath in imageRenderListener.ImagePaths)
            {
                using var img = Pix.LoadFromFile(imagePath);
                using var result = engine.Process(img);
                Console.WriteLine($"Text on page {i}:\n{result.GetText()}");
                File.Delete(imagePath); // Clean up temp file
            }
        }
    }

    class ImageRenderListener : IEventListener
    {
        private readonly int _pageNum;
        public List<string> ImagePaths { get; } = new List<string>();

        public ImageRenderListener(int pageNum) => _pageNum = pageNum;

        public void EventOccurred(IEventData data, EventType type)
        {
            if (type == EventType.RENDER_IMAGE)
            {
                var renderInfo = (ImageRenderInfo)data;
                var imageObj = renderInfo.GetImage();
                var imgBytes = imageObj.GetImageBytes();
                var img = System.Drawing.Image.FromStream(new MemoryStream(imgBytes));
                var fileName = Path.Combine(Path.GetTempPath(), $"page_{_pageNum}.png");
                img.Save(fileName, ImageFormat.Png);
                ImagePaths.Add(fileName);
            }
        }

        public ICollection<EventType> GetSupportedEvents() => new[] { EventType.RENDER_IMAGE };
    }
}

using System;
using System.IO;
using ImageMagick;
using Tesseract;

class Program
{
    static void Main()
    {
        string pdfPath = @"C:\path\to\your\scanned.pdf";
        string tessDataPath = @"C:\tessdata"; // path to traineddata folder

        using var engine = new TesseractEngine(tessDataPath, "eng", EngineMode.Default);

        using var images = new MagickImageCollection();
        images.Read(pdfPath);

        int pageIndex = 1;
        foreach (var image in images)
        {
            using var memStream = new MemoryStream();
            image.Format = MagickFormat.Png;
            image.Write(memStream);
            memStream.Position = 0;

            using var img = new System.Drawing.Bitmap(memStream);
            using var pix = PixConverter.ToPix(img);
            using var result = engine.Process(pix);
            
            Console.WriteLine($"--- Page {pageIndex} ---");
            Console.WriteLine(result.GetText());
            pageIndex++;
        }
    }
}

using iTextSharp.text.pdf;
using System.Drawing;
using System.Drawing.Imaging;

public void ConvertPdfToPng(string pdfPath, string outputFolder)
{
    // Create output directory if it doesn't exist
    Directory.CreateDirectory(outputFolder);
    
    using (var document = new PdfReader(pdfPath))
    {
        for (int page = 1; page <= document.NumberOfPages; page++)
        {
            // Set resolution (DPI)
            var pdfDoc = new iTextSharp.text.Document();
            var writer = PdfWriter.GetInstance(pdfDoc, new MemoryStream());
            pdfDoc.Open();
            
            // Get the page
            var importedPage = writer.GetImportedPage(document, page);
            
            // Create bitmap
            var bitmap = new Bitmap(importedPage.Width, importedPage.Height);
            using (var g = Graphics.FromImage(bitmap))
            {
                g.Clear(Color.White);
                g.DrawImage(bitmap, 0, 0, importedPage.Width, importedPage.Height);
            }
            
            // Save as PNG
            string outputPath = Path.Combine(outputFolder, $"page_{page}.png");
            bitmap.Save(outputPath, ImageFormat.Png);
        }
    }
}


